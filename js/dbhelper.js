"use strict";var _createClass=function(){function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function a(){_classCallCheck(this,a)}return _createClass(a,null,[{key:"openIndexedDB",value:function(n){if(!navigator.serviceWorker||!window.indexedDB)return console.log("IndexedDB not supported");var t,e=window.indexedDB.open(a.IDB_DATABASE_NAME,a.IDB_VERSION);e.onerror=function(e){console.log("An error occured when trying to open indexedDB",e.target.errorCode)},e.onsuccess=function(e){t=e.target.result,n(t)},e.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(a.IDB_RESTAURANT_STORE_NAME,{keyPath:"id"})}}},{key:"fetchRestaurants",value:function(n){fetch(a.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return n(null,e)}).catch(function(e){console.log("Request failed. Returned status of  "+e)})}},{key:"fetchRestaurantById",value:function(r,u){a.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.find(function(e){return e.id==r});t?u(null,t):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){a.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.cuisine_type==r});u(null,t)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){a.fetchRestaurants(function(e,n){if(e)u(e,null);else{var t=n.filter(function(e){return e.neighborhood==r});u(null,t)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,o){a.fetchRestaurants(function(e,n){if(e)o(e,null);else{var t=n;"all"!=r&&(t=t.filter(function(e){return e.cuisine_type==r})),"all"!=u&&(t=t.filter(function(e){return e.neighborhood==u})),o(null,t)}})}},{key:"fetchNeighborhoods",value:function(u){a.fetchRestaurants(function(e,t){if(e)u(e,null);else{var r=t.map(function(e,n){return t[n].neighborhood}),n=r.filter(function(e,n){return r.indexOf(e)==n});u(null,n)}})}},{key:"fetchCuisines",value:function(u){a.fetchRestaurants(function(e,t){if(e)u(e,null);else{var r=t.map(function(e,n){return t[n].cuisine_type}),n=r.filter(function(e,n){return r.indexOf(e)==n});u(null,n)}})}},{key:"fetchReviews",value:function(n){fetch(a.REVIEWS_URL).then(function(e){return e.json()}).then(function(e){return n(null,e)}).catch(function(e){console.log("Request for reviews failed. Returned status of  "+e)})}},{key:"reviewsById",value:function(r){a.fetchReviews(function(e,n){if(e)r(e,null);else{var t=n.filter(function(e){return e.restaurant_id===self.restaurant.id});r(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/img/"+e.photograph+".webp"}},{key:"mapMarkerForRestaurant",value:function(e,n){var t=new L.marker([e.latlng.lat,e.latlng.lng],{title:e.name,alt:e.name,url:a.urlForRestaurant(e)});return t.addTo(newMap),t}},{key:"addToFavLocal",value:function(r){a.openIndexedDB(function(e){var t=e.transaction("restaurants","readwrite").objectStore("restaurants");t.get(r.id).onsuccess=function(e){var n=e.target.result;n=Object.assign({},n,r),t.put(n),console.log("addToFavLocal -> success")}})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}},{key:"REVIEWS_URL",get:function(){return"http://localhost:1337/reviews"}},{key:"IDB_DATABASE_NAME",get:function(){return"restaurants-db"}},{key:"IDB_VERSION",get:function(){return 1}},{key:"IDB_RESTAURANT_STORE_NAME",get:function(){return"restaurants"}}]),a}();